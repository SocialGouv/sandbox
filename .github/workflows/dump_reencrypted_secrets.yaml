name: Debug - dump encrypted secrets reencrypted with kubeseal

on:
  workflow_dispatch:

jobs:
  dump:
    name: Dump
    runs-on: ubuntu-latest
    steps:
    - name: Install kubeseal
      run: |
        wget https://github.com/bitnami-labs/sealed-secrets/releases/download/v0.22.0/kubeseal-0.22.0-linux-amd64.tar.gz
        tar -xvzf kubeseal-0.22.0-linux-amd64.tar.gz kubeseal
        sudo install -m 755 kubeseal /usr/local/bin/kubeseal
    - name: Dump and reencrypt secrets
      run: |
        echo -n "{{secrets.KUBECONFIG}}" > kubeconfig
        echo -n "{{secrets.KUBECONFIG}}" | kubeseal --raw --controller-namespace sealed-secrets-system --name test --kubeconfig kubeconfig
